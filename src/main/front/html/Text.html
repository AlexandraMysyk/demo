<!DOCTYPE html>
<html>

<head>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <meta charset="UTF-8">
  <link rel="stylesheet" href="../css/style.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="../scripts/script.js"></script>
  <title>The Impact of Technology on Society</title>
  <style>
    /* Стилі для підсвічування */
    .highlight {
      background-color: #f2e9ff;
    }

    .selected {
      color: #7a5fd9;
    }

    .word {
      cursor: pointer;
    }
  </style>
</head>

<body>
  <header>
    <ul class="tab-container">
      <li><a href="Texts.html">Texts</a></li>
      <li><a href="Tasks.html">Tasks</a></li>
      <li><a href="Dictionary.html">Personal dictionary</a></li>
      <li><a href="Profile.html">Profile</a></li>
    </ul>
  </header>
  <h1>Read Text</h1>
  <div id="target"></div>
  <form class="form-container">
    <h2 id="textName"></h2>
    <h2 id="textLevel"></h2>
    <p id="text" class="text"></p>

    <div class="buttons">
      <button type="button" onclick="open_list_text()">Return to texts</button>
    </div>
    <div id="result"></div>
  </form>
  <script>

    let texts = "";

    function getTranslation(word) {
      const m_word = word.innerHTML.trim();
      const url = `https://api.dictionaryapi.dev/api/v2/entries/en/${m_word}`;
      const langFrom = 'en';
      const langTo = 'uk';
      const apiUrl = `https://api.mymemory.translated.net/get?q=${m_word}&langpair=${langFrom}|${langTo}`;

      const resultElement = document.getElementById('result');

      fetch(url)
        .then(response => response.json())
        .then(data => {
          const definition = data[0].meanings[0].definitions[0].definition;
          resultElement.innerHTML = `<h2>Word: ${m_word}</h2><h2>Meaning: ${definition}</h2>`;
        })
        .catch(() => {
          resultElement.innerHTML = `<p class="error">Couldn't find the word</p>`;
        });

      if (!m_word) {
        return;
      }

      fetch(apiUrl)
        .then(response => response.json())
        .then(data => {
          const translatedText = data.responseData.translatedText;
          resultElement.innerHTML += `<h2>Translation: ${translatedText}</h2>`;
        })
        .catch(error => console.error(error));
    }
    function getText(id) {
      const resultElement = document.getElementById('result');
      const url = `http://localhost:8080/api/getText/${id}`;

      fetch(url)
        .then(response => {
          if (response.ok) {
            return response.text();
          } else {
            throw new Error('Error: ' + response.status);
          }
        })
        .then(data => {
          const values = data.split(',');
          const id = values[0];
          const textLevel = values[1];
          let content = "";
          for (let i = 2; i <= values.length - 3; i++) {
            content += values[i];
          }
          const textName = values[values.length - 2];
          const id_admin = values[values.length - 1];
          const definition = data;
          document.getElementById("textName").innerHTML = wrapWordsInSpans(textName);
          document.getElementById("textLevel").innerHTML = wrapWordsInSpans(textLevel);

          document.getElementById("text").innerHTML = wrapWordsInSpans(content);
          words = document.querySelectorAll('.word');

          words.forEach(word => {
            word.addEventListener('mouseover', () => {
              word.classList.add('highlight');
            });

            word.addEventListener('mouseout', () => {
              word.classList.remove('highlight');
            });

            let translationVisible = false;

            let selectedWord = null;
            word.addEventListener('click', () => {
              if (selectedWord) {
                selectedWord.classList.remove('selected');
                translationVisible = false;
                selectedWord = null;
              }
              word.classList.add('selected');
              selectedWord = word;
              const translation = getTranslation(word);
              const selectedText = document.createElement('span');
              selectedText.textContent = translation;
              selectedText.classList.add('selected-text');
              word.parentNode.insertBefore(selectedText, word.nextSibling);
              word.classList.add('selected');
              translationVisible = true;

            });
          });
        })
    }

    function getTextId(texts, name) {
      let wordSpans = [];
      wordSpans = getTextsName(texts);
      for (let i = 0; i < wordSpans.length; i++) {
        if (name == wordSpans[i]) {
          return getTextsId(texts)[i];
        }
      }

    }
    function getTextsId(texts) {
      const modifiedString = texts.replace(/\[\"|\"\]/g, '');
      const values = modifiedString.split('","');

      let wordSpans = [];
      let wordSpans2 = [];

      console.log(values);
      for (let i = 0; i < values.length; i++) {
        wordSpans[i] = values[i].split(',')[0];
      }
      return wordSpans;
    }
    function getTextsName(texts) {
      const modifiedString = texts.replace(/\[\"|\"\]/g, '');
      const values = modifiedString.split('","');

      let wordSpans = [];
      let wordSpans2 = [];

      console.log(values);
      for (let i = 0; i < values.length; i++) {
        wordSpans[i] = values[i].split(',')[1];
      }
      return wordSpans;
    }
    function getTextName(texts, id) {
      return getTextsName(texts)[id];
    }
    function getListOfText() {
      const textLevel = selectElement.options[selectElement.selectedIndex].textContent;
      const url = `http://localhost:8080/api/getTextsByLevel/${textLevel}`;
      fetch(url)
        .then(response => {
          if (response.ok) {
            return response.text();
          } else {
            throw new Error('Error: ' + response.status);
          }
        })
        .then(data => {
          if (data != "[]") {
            texts = wrapTextItem(data);
          }
          else {
            texts.innerHTML = "";
          }

        })
    }
    getText(localStorage.getItem('TextId'));
    var text = {
  "id_text": 100,
  "complexity_level": "",
  "content": "",
  "name": "",
  "id_admin": 1
};

axios.post(`http://localhost:8080/api/addText`, {
  "id_text": 100,
  "complexity_level": "",
  "content": "",
  "name": "",
  "id_admin": 1
}, {
  headers: {
    'Content-Type': 'application/json'
  }
})
  .then(response => {
    console.log('Текст успішно додано до бази даних');
  })
  // .catch(error => {
  //   console.error('Помилка при додаванні тексту до бази даних', error);
  // }
  // );
  </script>

</body>

</html>