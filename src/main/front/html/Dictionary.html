<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Dictionary</title>
  <script src="script.js"></script>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/Dictionary.css">
  <style>
    input {
	  flex: 1 1 400px;
	  padding: 10px;
	  border: 2px solid #7b2cbf;
	  border-radius: 5px;
	  margin-bottom: 20px;
	  font-size: 16px;
	  color: #7b2cbf;
	  width: 100%;
	 
  }
  .hidden {
  display: none; /* Приховування елементів з класом "hidden" */
}
  </style>
</head>
<body>
  <header>
    <ul class="tab-container">
      <li><a href="Texts.html">Texts</a></li>
      <li><a href="Tasks.html">Tasks</a></li>
      <li><a class="active" href="Dictionary.html">Personal dictionary</a></li>
      <li><a href="Profile.html">Profile</a></li>
    </ul>
  </header>  
  <h1>Working with a Dictionary</h1>
  <form class="filter-row">
    <div id="dictionary">
      <ul id="wordList">
        <li>
          <table class="word-item center-table">
            <tr>
              <td>
                <h3 class="title">word:</h3>
              </td>
              <td>
                <p class="value"></p>
              </td>
            </tr>
            <tr class="full-row hidden">
              <td>
                <h3 class="title">translation:</h3>
              </td>
              <td>
                <p class="value"></p>
              </td>
            </tr>
            <tr class="full-row hidden">
              <td>
                <h3 class="title">meaning:</h3>
              </td>
              <td>
                <p class="value"></p>
              </td>
            </tr>
            <tr class="full-row hidden">
              <td>
                <h3 class="title">content:</h3>
              </td>
              <td>
                <p class="value"></p>
              </td>
            </tr>
            <tr class="full-row hidden">
              <td colspan="2" class="image-container">
                <img class="image">
              </td>
            </tr>
            <tr>
              <td colspan="2">
                <button class="open-button" onclick="toggleDetails(this)">Open</button>
                <button class="edit-button" onclick="editWord(this)">Edit</button>
              </td>
            </tr>
          </table>
        </li>
      </ul>
    </div>
  </form>
<script>
 function toggleDetails(button) {
  event.preventDefault();
  const wordItem = button.closest('.word-item');
  const detailsRows = wordItem.querySelectorAll('.full-row');

  detailsRows.forEach(row => {
    row.classList.toggle('hidden');
  });

  if (button.innerHTML === "Open") {
    button.innerHTML = "Close";
  } else {
    button.innerHTML = "Open";
  }
}
function editWord(button) {
  event.preventDefault();
  const wordItem = button.closest('.word-item');
  const valueElements = wordItem.querySelectorAll('.value');
  const imageElement = wordItem.querySelector('.image');
  const editButton = wordItem.querySelector('.edit-button');

  if (editButton.innerHTML === "Edit") {
    editButton.innerHTML = "Save";

    // Enable editing and display input fields
    valueElements.forEach(element => {
      const value = element.innerHTML;
      const input = document.createElement('input');
      input.value = value;
      element.innerHTML = '';
      element.appendChild(input);
    });

    const imageLinkInput = document.createElement('input');
    imageLinkInput.type = 'text';
    imageLinkInput.value = imageElement.src;
    imageElement.parentNode.replaceChild(imageLinkInput, imageElement);
  } else {
    editButton.innerHTML = "Edit";

    // Disable editing and update values
    valueElements.forEach(element => {
      const input = element.querySelector('input');
      const value = input.value;
      element.innerHTML = value;
    });

    const imageLinkInput = wordItem.querySelector('input[type="text"]');
    const newImageSrc = imageLinkInput.value;
    const newImageElement = document.createElement('img');
    newImageElement.classList.add('image');
    newImageElement.src = newImageSrc;
    newImageElement.alt = 'Image';
    imageLinkInput.parentNode.replaceChild(newImageElement, imageLinkInput);
  }
}

function fillWordTable() {
  var wordTable = document.getElementById('wordList');
  
  // Очищення таблички перед заповненням
  wordTable.innerHTML = '';
  
  // Загрузка JSON-даних (припустимо, що дані містяться у файлі words.json)
  fetch(`http://localhost:8080/api/getAllWords/${localStorage.getItem("userId")}`)
    .then(response => response.json())
    .then(data => {
      // Проітерування об'єкта зі словами та додавання їх до таблички
      for (var i = 0; i < data.words.length; i++) {
        var word = data.words[i];
        
        // Створення нового елементу li
        var li = document.createElement('li');
        
        // Створення копії таблички слов та додавання її до li
        var table = document.querySelector('.word-item');
        var tableClone = table.cloneNode(true);
        li.appendChild(tableClone);
        
        // Заповнення полів таблички зі значеннями з JSON-даних
        tableClone.querySelector('.title').textContent = 'word:';
        tableClone.querySelector('.value').textContent = word.word;
        
        var translationRow = tableClone.querySelector('.full-row:nth-child(2)');
        translationRow.querySelector('.title').textContent = 'translation:';
        translationRow.querySelector('.value').textContent = word.translation;
        
        var meaningRow = tableClone.querySelector('.full-row:nth-child(3)');
        meaningRow.querySelector('.title').textContent = 'meaning:';
        meaningRow.querySelector('.value').textContent = word.meaning;
        
        var contentRow = tableClone.querySelector('.full-row:nth-child(4)');
        contentRow.querySelector('.title').textContent = 'content:';
        contentRow.querySelector('.value').textContent = word.content;
        
        // Додавання кнопок "Open" та "Edit"
         var buttonRow = tableClone.querySelector('tr:last-child');
        var openButton = document.createElement('button');
        openButton.className = 'open-button';
        openButton.textContent = 'Open';
        openButton.onclick = toggleDetails;
        buttonRow.querySelector('td').appendChild(openButton);

        var editButton = document.createElement('button');
        editButton.className = 'edit-button';
        editButton.textContent = 'Edit';
        editButton.onclick = editWord;
        buttonRow.querySelector('td').appendChild(editButton);

        // Додавання li до таблички
        wordTable.appendChild(li);
      }
    })
    .catch(error => {
      console.error('Помилка:', error);
    });
}

// Виклик функції для заповнення таблички словами
fillWordTable();
</script>
</body>
</html>